<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Vendor Request Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
	<!-- Choices.js CDN -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <style>
        body {
            background: linear-gradient(to right, #a6c1ee, #fbc2eb);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .glass {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 700px;
            height: 85vh;
            overflow-y: auto;
        }
        label {
            font-weight: bold;
            color: #333;
        }
        .hidden { display: none; }
        .submit-btn {
            background: linear-gradient(135deg, #ff6a88, #ff99ac);
            padding: 14px 28px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 106, 136, 0.5);
        }
    </style>
</head>
<body>
    <div class="glass p-6">
		<div id="successMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert"></div>
        <h2 class="text-2xl font-bold text-center mb-4 text-gray-900">Market Vendor Request Form</h2>
        <form id="marketVendorRequestForm" onsubmit="generateVendorId(event)">
            <div class="mb-4">
                <label>Vendor Business Name <span style='color: red;'>*</span></label>
                <input type="text" name="vendorName" id="vendorName" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div class="mb-4">
                <label>Primary Contact First Name <span style='color: red;'>*</span></label>
                <input type="text" name="primaryFirstName" id="primaryFirstName" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div class="mb-4">
                <label>Primary Contact Last Name <span style='color: red;'>*</span></label>
                <input type="text" name="primaryLastName" id="primaryLastName" class="w-full p-2 border rounded bg-white" required>
            </div>
			<div class="mb-4">
                <label>Secondary Contact First Name</label>
                <input type="text" name="secondaryFirstName" id="secondaryFirstName" class="w-full p-2 border rounded bg-white">
            </div>
            <div class="mb-4">
                <label>Secondary Contact Last Name</label>
                <input type="text" name="secondaryLastName" id="secondaryLastName" class="w-full p-2 border rounded bg-white">
            </div>
            <div class="mb-4">
                <label>Vendor Mailing Address <span style='color: red;'>*</span></label>
                <input type="text" name="vendorAddress" id="vendorAddress" class="w-full p-2 border rounded bg-white" required>
                <label class="mt-2">Is this address? <span style='color: red;'>*</span></label>
                <select class="w-full p-2 border rounded bg-white" name="vendorAddressType" id="vendorAddressType" required>
                    <option value="">- Select Address Type -</option>
                    <option value="Residential">Residential</option>
                    <option value="Business">Business</option>
                    <option value="Business">Both</option>
                </select>
            </div>
			<div class="mb-4">
                <label>Who is your Contractor? <span style='color: red;'>*</span></label>
                <select id="contractor" name="contractor" class="w-full p-2 border rounded bg-white" required>
                    <option value="">- Select -</option>
                    <option value="REACH">REACH</option>
                    <option value="PGL">PGL</option>
                </select>
            </div>
            <div class="mb-4">
                <label>Email Address <span style='color: red;'>*</span></label>
                <input type="email" name="emailAddress" id="emailAddress" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div class="mb-4">
                <label>Vendor Type <span style='color: red;'>*</span></label>
                <select id="vendorType" name="vendorType" class="w-full p-2 border rounded bg-white" onchange="handleVendorType()" required>
                    <option value="">- Select Vendor Type -</option>
                    <option value="FARM">Farmer</option>
                    <option value="HOT">Hot Food Vendor</option>
                    <option value="VAP">Value Added Producer</option>
                    <option value="ENT">Entertainer</option>
                    <option value="EDU">Educator</option>
                    <option value="RETAIL">Non-Food Retailer (Clothing, jewelry, etc)</option>
                    <option value="OTHER">Other</option>
                </select>
                <input type="text" id="vendorTypeOther" name="vendorTypeOther" class="w-full p-2 border rounded bg-white mt-2 hidden" placeholder="Please specify other vendor type">
            </div>
            <!-- <div id="farmerFields" class="hidden">
                <label>What crops will you be selling at the market? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
                <label>On average, how much (pounds of produce) would you bring? <span style='color: red;'>*</span></label>
                <input type="number" class="w-full p-2 border rounded bg-white" required>
                <label>Which crops are specialty (culture-specific)? Mention cultures/nationalities <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div id="entertainerFields" class="hidden">
                <label>What type of entertainment do you provide? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
                <label>Do you have all necessary resources? If not, what do you need? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div id="educatorFields" class="hidden">
                <label>What type of educational content do you provide and for whom? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div id="hotFoodVendorFields" class="hidden">
                <label>What type of hot food do you provide? (Include prices) <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
                <label>Do you have all necessary resources? If not, what do you need? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
            </div>
			<div id="valueAddedProducerFields" class="hidden">
                <label>What value-added products (processed foods) would you be selling at the market? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
                <label>What are your prices? <span style='color: red;'>*</span></label>
                <input type="text" class="w-full p-2 border rounded bg-white" required>
            </div> -->
            <div class="mb-4">
                <label>Vendor Age <span style='color: red;'>*</span></label>
                <input type="number" name="vendorAge" id="vendorAge" class="w-full p-2 border rounded bg-white" required>
            </div>
            <div class="mb-4">
                <label>Vendor Race/Ethnicity <span style='color: red;'>*</span></label>
                <select id="vendorRace" name="vendorRace" class="w-full p-2 border rounded bg-white" required>
                    <option value="">- Select Race -</option>
                    <option value="African/African-American/Black">African/African-American/Black</option>
                    <option value="American Indian/Alaskan Native/Indigenous American">American Indian/Alaskan Native/Indigenous American</option>
                    <option value="Caucasian/European/European-American/White">Caucasian/European/European-American/White</option>
                    <option value="South Asian/South Asian-American">South Asian/South Asian-American</option>
					<option value="East Asian/East Asian-American">East Asian/East Asian-American</option>
                    <option value="Latine (Latino/a/x) or Hispanic">Latine (Latino/a/x) or Hispanic</option>
					<option value="Native Hawaiian/Pacific Islander">Native Hawaiian/Pacific Islander</option>
					<option value="Other">Other</option>
                </select>
				<div id="otherRaceDiv" class="hidden">
					<label for="otherRace">Please specify </label>
					<input type="text" id="otherRace" name="otherRace" placeholder="Enter other race">
				</div>
            </div>
            <div class="mb-4">
				<label>Vendor Nationality <span style='color: red;'>*</span>
					<span class="text-sm text-gray-600 block">(Select all that apply â€” based on languages spoken in the household or nationalities primary cardholder identifies as)</span>
				</label>
				<select id="vendorNationality" name="vendorNationality" multiple class="w-full p-2 border rounded bg-white" required>
					<option value="U.S.">U.S.</option>
					<option value="Japanese">Japanese</option>
					<option value="Chinese">Chinese</option>
					<option value="Korean">Korean</option>
					<option value="Vietnamese">Vietnamese</option>
					<option value="Other East Asian">Other East Asian</option>
					<option value="Indian">Indian</option>
					<option value="Pakistani">Pakistani</option>
					<option value="Sri Lankan">Sri Lankan</option>
					<option value="Burmese">Burmese</option>
					<option value="Cambodian">Cambodian</option>
					<option value="Other South or Southeast Asian">Other South or Southeast Asian</option>
					<option value="Ethiopian">Ethiopian</option>
					<option value="Eritrean">Eritrean</option>
					<option value="Somali">Somali</option>
					<option value="Other East African">Other East African</option>
					<option value="Liberian">Liberian</option>
					<option value="Nigerian">Nigerian</option>
					<option value="Ghanaian">Ghanaian</option>
					<option value="Congolese">Congolese</option>
					<option value="Cameroonian">Cameroonian</option>
					<option value="Other West, Central or North African">Other West, Central or North African</option>
					<option value="Middle Eastern">Middle Eastern</option>
					<option value="Mexican">Mexican</option>
					<option value="Central American">Central American</option>
					<option value="South American">South American</option>
					<option value="Caribbean Island">Caribbean Island</option>
					<option value="Pacific Islander">Pacific Islander</option>
					<option value="Ukrainian">Ukrainian</option>
					<option value="Russian">Russian</option>
					<option value="Other European">Other European</option>
					<option value="Other">Other</option>
				</select>
				<div id="otherNationalityDiv" class="mt-3 hidden">
					<label>Please specify <span style='color: red;'>*</span></label>
					<input type="text" id="otherNationality" name="otherNationality" class="w-full p-2 border rounded bg-white mt-1" placeholder="Enter other nationality">
				</div>
			</div>
            <div class="mb-4">
                <label>Vendor Organization Type <span style='color: red;'>*</span></label>
                <select id="vendorOrgType" name="vendorOrgType" class="w-full p-2 border rounded bg-white" required>
                    <option value="">- Select Organization Type -</option>
                    <option value="501c">501c</option>
                    <option value="LLC">LLC</option>
                    <option value="Other">Other</option>
				</select>
            </div>
            <!-- <div class="mb-4">
                <label>EIN Number:</label>
                <input type="text" class="w-full p-2 border rounded bg-white">
            </div> -->
            <!-- <div class="mb-4">
                <label>Anticipated % of market days you will attend:</label>
                <input type="text" class="w-full p-2 border rounded bg-white">
            </div>
            <div class="mb-4">
                <label>Dates you will likely not be able to attend:</label>
                <input type="text" class="w-full p-2 border rounded bg-white">
            </div> -->
            <div class="mb-4">
			  <label class="block font-bold mb-2">Upload Required Documentation <span class='text-red-500'>*</span></label>

			  <label class="block mb-1">Completed W9 Form</label>
			  <input type="file" name="w9" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Proof of Active Business Registry</label>
			  <input type="file" name="registry" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Proof of Business Insurance</label>
			  <input type="file" name="insurance" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Completed Vendor Agreement</label>
			  <input type="file" name="agreement" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Proof of Bank Account / Direct Deposit Register</label>
			  <input type="file" name="bankproof" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Rental Agreement for Equipment</label>
			  <input type="file" name="rentalAgreement" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Farmer-Produce Agreement</label>
			  <input type="file" name="farmerAgreement" required class="w-full p-2 border rounded bg-white">

			  <label class="block mt-3 mb-1">Organization Tabling Agreement</label>
			  <input type="file" name="tablingAgreement" required class="w-full p-2 border rounded bg-white">
			</div>

            <div class="mb-4">
                <label>Do you have a U.S. checking or savings account to receive direct deposit? <span style='color: red;'>*</span></label>
                <select class="w-full p-2 border rounded bg-white" name="bankAccount" id="bankAccount" required>
                    <option value="">- Select -</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="mb-4">
                <label>What is your level of English competency? <span style='color: red;'>*</span></label><br>
                <label>Spoken English </label>
                <select class="w-full p-2 border rounded bg-white" name="spokenEnglish" id="spokenEnglish" required>
                    <option>Fluent</option>
                    <option>Proficient</option>
                    <option>Competent</option>
                    <option>Limited</option>
                    <option>None</option>
                </select>
                <label>Written English</label>
                <select class="w-full p-2 border rounded bg-white" name="writtenEnglish" id="writtenEnglish" required>
                    <option>Fluent</option>
                    <option>Proficient</option>
                    <option>Competent</option>
                    <option>Limited</option>
                    <option>None</option>
                </select>
			</div>
			<div class="mb-4">
                <label>What other languages do you speak/write at least competently? 
				<span class="text-sm text-gray-600 block">(list all, if any)</span></label>
                <input list="languageOptions" name="otherLang" id="otherLang">
	                <datalist id="languageOptions">
					  <option value="Spanish">
					  <option value="Chinese">
					  <option value="Tagalog">
					  <option value="Vietnamese">
					  <option value="Arabic">
					  <option value="French">
					  <option value="Haitian Creole">
					  <option value="Korean">
					  <option value="Russian">
					  <option value="Portuguese">
					  <option value="Japanese">
					  <option value="German">
					  <option value="Somali">
					  <option value="Swahili">
					  <option value="Amharic">
					  <option value="Oromo">
					  <option value="Hindi">
					  <option value="Urdu">
					  <option value="Punjabi">
					  <option value="Nepali">
					  <option value="Bengali">
					  <option value="Burmese">
					  <option value="Karen">
					  <option value="Rohingya">
					  <option value="Navajo">
					  <option value="Cherokee">
					</datalist>
            </div>
            <div class="mb-4">
                <label>Will you need to rent equipment? <span style='color: red;'>*</span>
				<span class="text-sm text-gray-600 block">(e.g. chair, table, tent)</span></label>
                <select class="w-full p-2 border rounded bg-white" name="rentEquipment" id="rentEquipment">
					<option value="">- Select -</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
                <p class="text-sm text-gray-600">If no, you are indicating that you will bring your own chair, table, and tent to each market.</p>
            </div>
            <div class="mb-4">
                <label>Is there any additional information that you want to share with us?</label>
                <textarea class="w-full p-2 border rounded bg-white" name="comments" id="comments" rows="3"></textarea>
            </div>
			<input type="hidden" name="vendorId" id="vendorId">
			<input type="hidden" name="individualId" id="individualId">
            <div class="text-center">
                <button type="submit" class="submit-btn">Submit</button>
            </div>
        </form>
    </div>
	<script>			
		document.addEventListener('DOMContentLoaded', function () {
			new Choices('#vendorNationality', {
			removeItemButton: true,
			placeholderValue: 'Select Nationality',
			searchPlaceholderValue: 'Type to search...',
			shouldSort: false
			});
			
			const otherDiv = document.getElementById('otherNationalityDiv');
			const otherInput = document.getElementById('otherNationality');

			document.querySelector('#vendorNationality').addEventListener('change', function () {
				const selectedOptions = Array.from(this.selectedOptions).map(opt => opt.value);
				if (selectedOptions.includes('Other')) {
					otherDiv.classList.remove('hidden');
					otherInput.required = true;
				} else {
					otherDiv.classList.add('hidden');
					otherInput.required = false;
				}
			});
			
			new Choices('#vendorRace', {
				searchEnabled: true,
				shouldSort: false
			});

			const otherRaceDiv = document.getElementById('otherRaceDiv');
			const otherRaceInput = document.getElementById('otherRace');

			document.querySelector('#vendorRace').addEventListener('change', function () {
				const selectedOptions = Array.from(this.selectedOptions).map(opt => opt.value);
				if (selectedOptions.includes('Other')) {
					otherRaceDiv.classList.remove('hidden');
					otherRaceInput.required = true;
				} else {
					otherRaceDiv.classList.add('hidden');
					otherRaceInput.required = false;
				}
			});
		});
		
		function handleVendorType() {
		  const vendorType = document.getElementById('vendorType').value;
		  const otherField = document.getElementById('vendorTypeOther');
		  otherField.classList.toggle('hidden', vendorType !== 'OTHER');
		}

		function generateVendorId(e) {
		  e.preventDefault();
		  const contractor = document.getElementById('contractor').value;
		  let vendorType = document.getElementById('vendorType').value;
		  if (vendorType === 'OTHER') vendorType = 'OTHER';
		  const individualId = Math.floor(1000 + Math.random() * 9000);
		  const vendorId = `${contractor}-${vendorType}-${individualId}`;

		  document.getElementById("vendorId").value = vendorId;
		  document.getElementById("individualId").value = individualId;		  
	
		  const form = document.getElementById("marketVendorRequestForm");
		  const formData = new FormData(form);				  
					  
		  // Get nationality properly from multiselect
		  const nationalitySelect = document.getElementById("vendorNationality");
		  const allNationalities = Array.from(nationalitySelect.selectedOptions).map(opt => opt.value);
		
		  // Update FormData to include the full list as a single string (comma separated)
		  formData.set("vendorNationality", allNationalities.join(", "));
		  
		  const w9 = document.getElementById('w9');
		  const registry = document.getElementById('registry');
		  const insurance = document.getElementById('insurance');
		  const agreement = document.getElementById('agreement');
		  const bankproof = document.getElementById('bankproof');
		  const rentalAgreement = document.getElementById('rentalAgreement');
		  const farmerAgreement = document.getElementById('farmerAgreement');
		  const tablingAgreement = document.getElementById('tablingAgreement');
		  
		  
		  const w9File = w9.files;
		  const registryFile = registry.files;
		  const insuranceFile = insurance.files;
		  const agreementFile = agreement.files;
		  const bankproofFile = bankproof.files;
		  const rentalAgreementFile = rentalAgreement.files;
		  const farmerAgreementFile = farmerAgreement.files;
		  const tablingAgreementFile = tablingAgreement.files;
		  

		  if (w9File.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < w9File.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(w9File[i].type); // File MIME type
				if (base64Strings.length === w9File.length){
				  formData.append('w9FileData', JSON.stringify(base64Strings));
				  formData.append('w9FileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", w9File[i].name, e);
		  };

		  reader.readAsDataURL(w9File[i]);
		  }
		  }
		  
		  if (registryFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < registryFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(registryFile[i].type); // File MIME type
				if (base64Strings.length === w9File.length){
				  formData.append('registryFileData', JSON.stringify(base64Strings));
				  formData.append('registryFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", registryFile[i].name, e);
		  };

		  reader.readAsDataURL(registryFile[i]);
		  }
		  }
		  
		  if (insuranceFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < insuranceFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(insuranceFile[i].type); // File MIME type
				if (base64Strings.length === insuranceFile.length){
				  formData.append('insuranceFileData', JSON.stringify(base64Strings));
				  formData.append('insuranceFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", insuranceFile[i].name, e);
		  };

		  reader.readAsDataURL(insuranceFile[i]);
		  }
		  }
		  
		  if (agreementFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < agreementFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(agreementFile[i].type); // File MIME type
				if (base64Strings.length === agreementFile.length){
				  formData.append('agreementFileData', JSON.stringify(base64Strings));
				  formData.append('agreementFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", agreementFile[i].name, e);
		  };

		  reader.readAsDataURL(agreementFile[i]);
		  }
		  }
		  
		  if (bankproofFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < bankproofFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(bankproofFile[i].type); // File MIME type
				if (base64Strings.length === bankproofFile.length){
				  formData.append('bankproofFileData', JSON.stringify(base64Strings));
				  formData.append('bankproofFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", bankproofFile[i].name, e);
		  };

		  reader.readAsDataURL(bankproofFile[i]);
		  }
		  }
		  
		  if (rentalAgreementFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < rentalAgreementFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(rentalAgreementFile[i].type); // File MIME type
				if (base64Strings.length === rentalAgreementFile.length){
				  formData.append('rentalAgreementFileData', JSON.stringify(base64Strings));
				  formData.append('rentalAgreementFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", rentalAgreementFile[i].name, e);
		  };

		  reader.readAsDataURL(rentalAgreementFile[i]);
		  }
		  }
		  
		  if (farmerAgreementFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < farmerAgreementFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(farmerAgreementFile[i].type); // File MIME type
				if (base64Strings.length === farmerAgreementFile.length){
				  formData.append('farmerAgreementFileData', JSON.stringify(base64Strings));
				  formData.append('farmerAgreementFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", farmerAgreementFile[i].name, e);
		  };

		  reader.readAsDataURL(farmerAgreementFile[i]);
		  }
		  }
		  
		  if (tablingAgreementFile.length > 0) {
			const fileReaders = [];
			const base64Strings = [];
			const fileTypes = [];

			for (let i = 0; i < tablingAgreementFile.length; i++) {
			  const reader = new FileReader();
			  reader.onload = function(e) {
				base64Strings.push(e.target.result.split(',')[1]); // Base64 string
				fileTypes.push(tablingAgreementFile[i].type); // File MIME type
				if (base64Strings.length === tablingAgreementFile.length){
				  formData.append('tablingAgreementFileData', JSON.stringify(base64Strings));
				  formData.append('tablingAgreementFileTypes', JSON.stringify(fileTypes));
			}
		  };

		  reader.onerror = function(e) {
				console.error("Error reading file: ", tablingAgreementFile[i].name, e);
		  };

		  reader.readAsDataURL(tablingAgreementFile[i]);
		  }
		  }
			
			sendData(formData, vendorId);
		}
	
		function sendData(formData, vendorid) {
			const data = {};
			formData.forEach((value, key) => {
			  data[key] = value;
			});
			
			let vendorId = vendorid;
			
			let successMessage = document.getElementById("successMessage");
			successMessage.innerHTML = `<strong class="font-bold">Thank you!</strong> <span class="block sm:inline">Your Vendor ID is <strong>${vendorId}</strong>. We will notify you by email within 1-3 business days. If approved, you must submit all remaining documents before the market begins. If you have any questions, contact us at ######.</span>`;
			successMessage.classList.remove('hidden');
			  
			document.getElementById("marketVendorRequestForm").reset();
			window.scrollTo({ top: 0, behavior: 'smooth' });

			fetch('https://script.google.com/macros/s/AKfycbzGrcl2Rm8xhAynHKT0w8o4FEv6WKew0WWB6Z2g3dvf-uoC0-8ysuAFZYE_JTjElvjHQA/exec', {
			  method: 'POST',
			  headers: {
				'Content-Type': 'text/plain;charset=utf-8',
			  },
			  body: JSON.stringify(data),
			})
			.then(response => response.text())
			.then(result => {
			  console.log('Success:', result);
									
			  setTimeout(function() {
				successMessage.classList.add('hidden');
			  }, 5000);
			})
			.catch(error => {
			  console.error('Error:', error);
			  // Handle the error here
			});                
		}
	</script>
</body>
</html>
